<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ticket</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <nav th:replace="~{navbar :: navbar ('Ticket')}"></nav>

    <div class="container mt-4" th:object="${ticket}">
        <div class="row justify-content-center">
            <!-- Card Ticket -->
            <div class="col-md-6 mb-5">
                <div class="card border-dark text-center">
                    <div class="card-header fs-5" th:text="${ticket.operatore.email}"></div>
                    <div class="card-body text-dark">
                        <h5 class="card-title fs-4" th:text="*{titolo}"></h5>
                        <p class="card-text fs-5" th:text="*{descrizione}"></p>
                    </div>
                    <div class="card-footer fs-5" th:text="*{stato}"></div>
                </div>
            </div>

            <!-- Sezione Note -->
            <div class="col-md-6">
                <div class="mb-3 text-center">
                    <a class="btn btn-dark" th:href="@{/ticket/{id}/nota(id=${ticket.id})}">
                        Crea Nota
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="25" fill="currentColor" class="bi bi-ticket-perforated-fill ms-1" viewBox="0 0 16 16">
                            <path d="M0 4.5A1.5 1.5 0 0 1 1.5 3h13A1.5 1.5 0 0 1 16 4.5V6a.5.5 0 0 1-.5.5 1.5 1.5 0 0 0 0 3 .5.5 0 0 1 .5.5v1.5a1.5 1.5 0 0 1-1.5 1.5h-13A1.5 1.5 0 0 1 0 11.5V10a.5.5 0 0 1 .5-.5 1.5 1.5 0 1 0 0-3A.5.5 0 0 1 0 6zm4-1v1h1v-1zm1 3v-1H4v1zm7 0v-1h-1v1zm-1-2h1v-1h-1zm-6 3H4v1h1zm7 1v-1h-1v1zm-7 1H4v1h1zm7 1v-1h-1v1zm-8 1v1h1v-1zm7 1h1v-1h-1z"/>
                        </svg>
                    </a>
                </div>

                <!-- Lista note -->
                <div th:if="${note.isEmpty()}" class="alert alert-warning text-center mt-4">
                    <h5>Non sono presenti note</h5>
                </div>

                <div th:unless="${note.isEmpty()}" class="row row-cols-1 row-cols-md-2 g-3">
                    <div class="col" th:each="item : ${note}">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5 class="card-title" th:text="${item.titolo}"></h5>
                                <p class="card-text" th:text="${item.testo}"></p>
                            </div>
                            <ul class="list-group list-group-flush bg-dark text-light">
                                <li class="list-group-item"th:text="${item.operatore != null ? item.operatore.email : (item.admin != null ? item.admin.email : 'N/D')}"></li>

                                <!-- <li class="list-group-item" th:if="${item.operatore != null}" th:text="${item.operatore.email}"></li>
                                <li class="list-group-item" th:unless="${item.operatore == null and item.admin != null}"  th:text="${item.admin.email}"></li> -->
                                <li class="list-group-item" th:text="${item.dataCreazione}"></li>
                                <li class="list-group-item bg-dark">
                                    <div class="d-flex justify-content-between">
                                        <form th:action="@{/nota/delete/{id}(id=${item.id})}" method="post">
                                            <button class="btn btn-danger btn-sm" type="submit" onclick="return confirm('sei sicuro di voler eliminare la nota?')">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash2-fill" viewBox="0 0 16 16">
                                                    <path d="M2.037 3.225A.7.7 0 0 1 2 3c0-1.105 2.686-2 6-2s6 .895 6 2a.7.7 0 0 1-.037.225l-1.684 10.104A2 2 0 0 1 10.305 15H5.694a2 2 0 0 1-1.973-1.671zm9.89-.69C10.966 2.214 9.578 2 8 2c-1.58 0-2.968.215-3.926.534-.477.16-.795.327-.975.466.18.14.498.307.975.466C5.032 3.786 6.42 4 8 4s2.967-.215 3.926-.534c.477-.16.795-.327.975-.466-.18-.14-.498-.307-.975-.466z"/>
                                                </svg>
                                            </button>
                                        </form>
                                        <a class="btn btn-light btn-sm" th:href="@{|/nota/edit/${item.id}|}">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-fill" viewBox="0 0 16 16">
                                                <path d="M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.5.5 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11z"/>
                                            </svg>
                                        </a>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>